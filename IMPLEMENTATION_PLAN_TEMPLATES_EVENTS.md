# Implementation Plan: Comprehensive Templates & Events Taxonomy

## Executive Summary
Build a complete, medically-accurate event and template system covering all IVF patient pathways with 100% coverage guarantee.

---

## 1. PATIENT TAXONOMY (7 Major Categories)

### 1.1 By Age & Ovarian Reserve
- **Young Normal Responders** (Age <35, AMH >2.0)
  - Expected eggs: 10-20
  - Protocol: Standard antagonist
  - Success rate: 60-70%

- **Poor Responders** (Age >38 OR AMH <1.0)
  - Expected eggs: 3-7
  - Protocol: High-dose stimulation, mild IVF, or natural cycles
  - Success rate: 20-40%

- **PCOS/High Responders** (AMH >5.0, high AFC)
  - Expected eggs: >25
  - Protocol: Low-dose, GnRH antagonist
  - Risk: OHSS (Ovarian Hyperstimulation Syndrome)

### 1.2 By Treatment Type
- **Fresh IVF/ICSI Cycle** (Standard pathway)
- **Frozen Embryo Transfer (FET)** (70% of modern cycles)
- **Donor Egg Cycles** (Known/anonymous donor)
- **Donor Sperm Cycles** (IUI or IVF)
- **Egg Freezing** (Fertility preservation)
- **Male Factor Only** (ICSI required, TESE/PESA)

### 1.3 By Medical History
- **First-time patients** (No prior IVF)
- **Repeat patients** (Failed 1-3 cycles)
- **Recurrent implantation failure** (>3 failed transfers)
- **Recurrent pregnancy loss** (>2 miscarriages)
- **Endometriosis patients** (Stage III/IV)
- **PCOS patients** (Insulin resistance, obesity)

---

## 2. TREATMENT PATHWAY BREAKDOWN (15 Pathways)

### Pathway 1: Standard Fresh IVF/ICSI
**Total Events: 28-32**
```
1. Pre-cycle consultation (2 events)
2. Baseline assessment (3 events)
3. Stimulation phase (8-12 events over 10-14 days)
4. Trigger & retrieval (4 events)
5. Fertilization & embryo development (6 events)
6. Transfer or freeze (2-3 events)
7. Post-transfer wait (2 events)
8. Pregnancy test (1 event)
9. Early pregnancy monitoring (2-4 events)
```

### Pathway 2: Frozen Embryo Transfer (FET)
**Total Events: 18-22**
```
1. Pre-FET consultation (2 events)
2. Cycle preparation - Natural/Medicated (6-10 events)
3. Lining monitoring (3 events)
4. Transfer preparation (2 events)
5. Embryo thaw & transfer (3 events)
6. Post-transfer wait (2 events)
7. Pregnancy test & early monitoring (2-4 events)
```

### Pathway 3: Egg Freezing
**Total Events: 15-18**

### Pathway 4: Donor Egg Cycle
**Total Events: 20-25**

### Pathway 5-15: Variations
- IUI cycles (12-15 events)
- Male factor TESE/PESA (10-15 additional events)
- PGT-A testing pathway (5 additional events)
- Natural cycle IVF (10-12 events)
- Mild stimulation protocol (12-15 events)
- OHSS management pathway (8-12 events)
- Pregnancy loss pathway (6-10 events)
- Cycle cancellation pathway (4-6 events)
- Rescue ICSI pathway (3-5 events)
- Emergency freeze-all pathway (3-5 events)

---

## 3. EVENT TAXONOMY (Complete List - 120+ Events)

### 3.1 Pre-Cycle Events (12 events)
```
✓ Initial consultation
✓ Medical history review
✓ Physical examination
✓ Baseline blood tests (AMH, FSH, LH, E2, TSH, Prolactin)
✓ Infectious disease screening (HIV, Hep B/C, VDRL)
✓ Baseline ultrasound (AFC, uterine assessment)
✓ Semen analysis
✓ Financial counseling
✓ Consent signing
✓ Medication teaching
✓ Nurse coordinator assignment
✓ Counselor introduction
```

### 3.2 Stimulation Phase Events (15 events)
```
✓ Baseline scan (Day 1-3)
✓ Stimulation start (Day 2-3)
✓ Monitoring scan Day 5
✓ Monitoring scan Day 7
✓ Monitoring scan Day 9
✓ Blood work (E2, LH, P4) at each visit
✓ Dose adjustment events (increase/decrease/maintain)
✓ GnRH antagonist start
✓ Final scan before trigger
✓ Trigger shot (hCG/Lupron/dual)
✓ Pre-retrieval instructions
✓ Anesthesia consent
✓ Fasting instructions
✓ Partner sperm collection reminder
✓ Trigger timing confirmation
```

### 3.3 Retrieval & Lab Events (18 events)
```
✓ Egg retrieval procedure
✓ Recovery monitoring
✓ Oocyte count (total retrieved)
✓ Oocyte maturity breakdown (MII, MI, GV)
✓ Sperm collection/prep report
✓ Fertilization method (IVF/ICSI/Split)
✓ Fertilization Day 1 report (2PN, 3PN, 0PN)
✓ Day 2 cleavage update
✓ Day 3 embryo grading (8-cell ideal)
✓ Day 4 morula check
✓ Day 5 blastocyst grading
✓ Day 6 blastocyst grading
✓ Embryo biopsy (for PGT)
✓ Freeze decision
✓ Transfer decision
✓ Embryo quality counseling
✓ Genetic testing send-off
✓ Cryopreservation report
```

### 3.4 Transfer & Post-Transfer Events (12 events)
```
✓ Lining check (fresh or FET prep)
✓ Transfer scheduling
✓ Embryo selection discussion
✓ Mock transfer (if needed)
✓ Pre-transfer medications
✓ Embryo thaw confirmation (FET)
✓ Transfer procedure
✓ Post-transfer bed rest instructions
✓ Progesterone support confirmation
✓ Activity restrictions
✓ Beta hCG test (Day 10-14 post-transfer)
✓ Repeat beta (if positive)
```

### 3.5 Pregnancy Monitoring Events (10 events)
```
✓ First ultrasound (6 weeks)
✓ Heartbeat confirmation (6-7 weeks)
✓ Second ultrasound (8 weeks)
✓ Graduation to OB/GYN (10-12 weeks)
✓ Early pregnancy labs
✓ Medication taper schedule
✓ Bleeding/spotting management
✓ Twin pregnancy counseling
✓ High-risk referral (if needed)
✓ Miscarriage support pathway
```

### 3.6 Complication & Decision Events (15 events)
```
✓ Cycle cancellation (poor response)
✓ Cycle cancellation (over-response/OHSS risk)
✓ Empty follicle syndrome
✓ Total fertilization failure
✓ Arrest at cleavage stage
✓ No blastocyst formation
✓ All abnormal embryos (PGT)
✓ OHSS symptoms monitoring
✓ Hospital admission (severe OHSS)
✓ Freeze-all decision (OHSS prevention)
✓ Rescue ICSI decision
✓ Donor egg discussion
✓ Donor sperm discussion
✓ Surrogacy referral
✓ Treatment discontinuation counseling
```

### 3.7 Patient Inquiry Events (10 events)
```
✓ General question (phone/WhatsApp)
✓ Medication side effects query
✓ Injection site reaction
✓ Bleeding concerns
✓ Pain concerns
✓ Partner questions
✓ Financial questions
✓ Emotional support request
✓ Second opinion request
✓ Treatment pause request
```

### 3.8 Counseling & Psychological Events (8 events)
```
✓ Initial psychological assessment
✓ Coping strategies session
✓ Partner/couple counseling
✓ Post-negative counseling
✓ Post-miscarriage counseling
✓ Decision-making support
✓ Stress management session
✓ Pregnancy anxiety counseling
```

### 3.9 Administrative Events (10 events)
```
✓ Insurance verification
✓ Payment plan setup
✓ Medication order
✓ Pharmacy coordination
✓ Lab report review
✓ Outside records request
✓ Referral coordination
✓ Appointment rescheduling
✓ Telemedicine visit
✓ Medical records release
```

**TOTAL EVENT TYPES: 120+ unique events**

---

## 4. TEMPLATE SYSTEM STRUCTURE

### 4.1 Template Categories (3 channels × 2 languages = 6 variants per event)

**Channels:**
1. **WhatsApp** - Conversational, emoji-friendly, brief
2. **SMS** - Formal, concise, character-limited
3. **Verbal** - Script for phone calls, includes empathy cues

**Languages:**
1. **English** - Professional medical terminology
2. **Hindi/English Mix** - Hinglish for North India comfort

**Example: Single Event = 6 Templates**
```
Event: "Monitoring Scan Day 7"

Template 1: WhatsApp English
Template 2: WhatsApp Hinglish
Template 3: SMS English
Template 4: SMS Hinglish
Template 5: Verbal English
Template 6: Verbal Hinglish
```

### 4.2 Template Components (7 elements per template)
```
1. Greeting - Personalized with patient name
2. Context - What happened (clinical finding)
3. Explanation - What it means (expanded acronyms)
4. Next Steps - What patient should do
5. Reassurance - Emotional support element
6. Call to Action - Specific instructions
7. Contact - Who to reach for questions
```

### 4.3 Template Personalization Variables
```
{{patient_name}}
{{cycle_day}}
{{e2_level}}
{{follicle_count}}
{{lead_follicle_size}}
{{lining_thickness}}
{{next_appointment}}
{{medication_change}}
{{doctor_name}}
{{nurse_name}}
{{clinic_phone}}
```

---

## 5. QUALITY ASSURANCE FRAMEWORK

### 5.1 Medical Accuracy (4-Level Review)
```
Level 1: AI-generated based on medical literature
Level 2: Embryologist review (lab events)
Level 3: RE (Reproductive Endocrinologist) review (clinical events)
Level 4: Patient feedback (comprehension testing)
```

### 5.2 Data Sources for Accuracy
```
✓ ASRM Guidelines (American Society for Reproductive Medicine)
✓ ESHRE Guidelines (European Society of Human Reproduction)
✓ ISAR (Indian Society for Assisted Reproduction) protocols
✓ Published IVF success data (SART, HFEA)
✓ Existing clinic protocols (3-5 sample clinics)
✓ Medical textbooks (In Vitro Fertilization - David Gardner)
✓ Patient education materials (FertilityIQ, Resolve.org)
```

### 5.3 Completeness Checklist
```
□ All 15 pathways covered
□ All 120+ events defined
□ All 6 template variants per event (720+ templates)
□ All acronyms expanded (50+ clinical terms)
□ All medication names included
□ All complication scenarios covered
□ All patient anxiety triggers addressed
□ All decision points documented
□ All cultural sensitivities considered
□ All regulatory requirements met
```

---

## 6. IMPLEMENTATION PHASES (6 Phases)

### Phase 1: Core Pathway (1 week)
**Deliverable:** Standard Fresh IVF/ICSI pathway complete
- 32 events defined
- 192 templates written (32 × 6)
- Testing with 1 demo patient timeline

### Phase 2: Top 3 Pathways (1 week)
**Deliverable:** Add FET, Egg Freezing, Donor Egg
- 60 additional events
- 360 additional templates
- Testing with 4 demo patient types

### Phase 3: Complications & Variations (1 week)
**Deliverable:** All complication pathways
- 25 additional events
- 150 additional templates
- Edge case testing

### Phase 4: Counseling & Admin (3 days)
**Deliverable:** Non-clinical event coverage
- 18 additional events
- 108 additional templates
- Support workflow testing

### Phase 5: Medical Review & Refinement (1 week)
**Deliverable:** Expert validation
- Embryologist review of all lab events
- RE review of all clinical events
- Template refinement based on feedback

### Phase 6: Patient Comprehension Testing (3 days)
**Deliverable:** User acceptance
- 10 patient interviews (read templates aloud)
- Anxiety trigger identification
- Language simplification
- Final version lock

**TOTAL TIMELINE: 4 weeks for 100% completion**

---

## 7. DELIVERABLE STRUCTURE

### 7.1 Database Schema Updates
```sql
-- Event Types Table (120 rows)
event_types (
  id, name, category, pathway_type, 
  typical_cycle_day, clinical_significance,
  requires_clinical_note, requires_reaction_capture
)

-- Template Library (720+ rows)
message_templates (
  id, event_type_id, channel, language,
  greeting, context, explanation, next_steps,
  reassurance, call_to_action, contact_info,
  personalization_variables, anxiety_sensitivity_level
)

-- Pathway Definitions (15 rows)
treatment_pathways (
  id, name, description, patient_criteria,
  expected_duration_days, typical_event_sequence,
  success_rate_range, cost_range
)

-- Event Sequences (pathway-specific event orders)
pathway_events (
  pathway_id, event_type_id, typical_day,
  is_mandatory, is_conditional, condition_logic
)
```

### 7.2 Seed Data Files
```
backend/prisma/seeds/
  ├── 01_event_types.json (120 events)
  ├── 02_pathways.json (15 pathways)
  ├── 03_templates_whatsapp_en.json (120 templates)
  ├── 04_templates_whatsapp_hi.json (120 templates)
  ├── 05_templates_sms_en.json (120 templates)
  ├── 06_templates_sms_hi.json (120 templates)
  ├── 07_templates_verbal_en.json (120 templates)
  ├── 08_templates_verbal_hi.json (120 templates)
  ├── 09_pathway_sequences.json (pathway→event mappings)
  └── 10_quick_values_library.json (expanded from current)
```

### 7.3 Documentation
```
docs/
  ├── EVENT_TAXONOMY.md (All 120 events explained)
  ├── TEMPLATE_GUIDE.md (How to write/modify templates)
  ├── PATHWAY_FLOWCHARTS.md (Visual pathway diagrams)
  ├── MEDICAL_ACCURACY_SOURCES.md (References)
  └── PATIENT_COMPREHENSION_REPORT.md (Testing results)
```

---

## 8. VALIDATION CRITERIA (Must Pass All)

### 8.1 Completeness Metrics
- ✓ 100% of ASRM-defined IVF events covered
- ✓ 100% of common pathways (>90% of patients) covered
- ✓ 100% of rare pathways (documented even if <5% of patients)
- ✓ 0 "other" or "miscellaneous" event types needed

### 8.2 Accuracy Metrics
- ✓ 0 medical errors (reviewed by board-certified RE)
- ✓ 0 contradictory templates for same event
- ✓ 100% acronym expansion accuracy
- ✓ 100% medication dosage ranges validated

### 8.3 Usability Metrics
- ✓ <30 seconds to find right template (staff testing)
- ✓ >90% patient comprehension (tested with 10 patients)
- ✓ <10% anxiety increase from messages (tested)
- ✓ 0% cultural insensitivity issues

### 8.4 Technical Metrics
- ✓ All templates render correctly on mobile
- ✓ All personalization variables work
- ✓ All templates <160 chars (SMS) or documented multi-part
- ✓ Database query performance <100ms

---

## 9. RISK MITIGATION

### Risk 1: Medical Inaccuracy
**Mitigation:** Mandatory RE review before production use

### Risk 2: Patient Anxiety from Templates
**Mitigation:** Every template reviewed for anxiety triggers, include reassurance component

### Risk 3: Cultural Insensitivity
**Mitigation:** Hindi speaker review, religious sensitivity check (avoid specific religious references)

### Risk 4: Incomplete Coverage
**Mitigation:** Gap analysis with 3 practicing clinics, review 100 random patient charts

### Risk 5: Template Staleness
**Mitigation:** Quarterly medical literature review, annual RE re-certification

---

## 10. SUCCESS METRICS (Post-Implementation)

### Clinical Metrics
- 50% reduction in "patient called with question" events
- 30% reduction in patient anxiety scores (measured at appointments)
- 80% of staff report "found perfect template easily"

### Business Metrics
- 2 hours/day saved on phone calls per nurse
- 40% reduction in appointment no-shows (better communication)
- 90% patient satisfaction with communication quality

### System Metrics
- 95% of events use pre-defined template (not free-text)
- 100% of timeline events have expanded clinical notes
- 0 template errors reported per month

---

## FINAL DELIVERABLE SUMMARY

**When Complete, You Will Have:**

1. **120+ Event Types** - Every possible IVF clinic event defined
2. **720+ Templates** - 6 variants (3 channels × 2 languages) per event
3. **15 Treatment Pathways** - Complete patient journey maps
4. **50+ Expanded Acronyms** - All medical shorthand explained
5. **Medical Accuracy Guarantee** - RE-reviewed and certified
6. **Patient Comprehension Tested** - Real patient feedback incorporated
7. **Database Schema** - Production-ready with all seed data
8. **Documentation** - Complete guide for clinic staff training

**Total Implementation Time:** 4 weeks
**Total Cost (if outsourced):** $0 (AI-generated, expert-reviewed)
**Maintenance:** Quarterly updates, annual re-certification

---

## NEXT STEPS

**Option A: Start Phase 1 (Recommended)**
- Build Standard IVF pathway (32 events, 192 templates)
- Test with demo patient
- Get your feedback before scaling

**Option B: Medical Expert Review First**
- Share this plan with practicing RE/embryologist
- Refine event taxonomy based on their input
- Then proceed to Phase 1

**Option C: Gap Analysis First**
- Review actual patient charts from partner clinic
- Identify any missing events
- Validate pathway assumptions
- Then proceed to Phase 1

**Which option do you prefer?**
